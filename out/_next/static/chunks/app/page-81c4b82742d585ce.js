(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5921:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>A});var a=s(5155),n=s(2115),l=s(5143),r=s(402),i=s(6671),d=s(8266),c=s(9911),o=s(2515),u=s(4315),m=s(5305),x=s(7859);let b=[{id:"brainstorm",title:"腦力激盪"},{id:"in-progress",title:"如火如荼"},{id:"done",title:"修成正果"},{id:"archived",title:"蛋雕區"}],h=[{id:"565a2883-8b76-4bfd-a5bf-282fb5df5fd7",statusId:"brainstorm",content:"關閉訂單與結帳",createdAt:"2025-08-12T02:35:24.226Z",updatedAt:"2025-08-12T02:35:24.226Z"},{id:"fe4734cc-d9da-4be8-969f-9777e81484ee",statusId:"brainstorm",content:"取得外送餐點",createdAt:"2025-08-12T02:35:48.800Z",updatedAt:"2025-08-12T02:35:48.800Z"},{id:"9c3cf7c0-434a-44dc-9979-9ad22ba45af0",statusId:"done",content:"選擇飲料店",createdAt:"2025-08-12T02:34:39.836Z",updatedAt:"2025-08-12T02:34:39.836Z"},{id:"617e8b0a-e3d5-48df-b050-1e614bb50e4a",statusId:"in-progress",content:"分享團購訂單",createdAt:"2025-08-12T02:34:47.340Z",updatedAt:"2025-08-12T02:34:47.340Z"},{id:"a58e6891-1ce0-4a70-99a1-d5aa7e1bcd70",statusId:"in-progress",content:"將品項加入購物車",createdAt:"2025-08-12T02:35:02.867Z",updatedAt:"2025-08-12T02:35:02.867Z"}],g=[{id:"A",name:"A 計畫",badge:"badge-primary",status:"status-primary",text:"text-primary"},{id:"B",name:"B 計畫",badge:"badge-secondary",status:"status-secondary",text:"text-secondary"},{id:"C",name:"C 計畫",badge:"badge-accent",status:"status-accent",text:"text-accent"},{id:"D",name:"D 計畫",badge:"badge-info",status:"status-info",text:"text-info"},{id:"E",name:"E 計畫",badge:"badge-success",status:"status-success",text:"text-success"}],p=e=>{let{tasks:t,labels:s,onEditTask:l}=e;return(0,a.jsx)("div",{className:"overflow-x-auto mt-5 rounded bg-base-100",children:(0,a.jsxs)("table",{className:"table table-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"內容"}),(0,a.jsx)("th",{children:"計畫"}),(0,a.jsx)("th",{children:"狀態"}),(0,a.jsx)("th",{children:"建立時間"})]})}),(0,a.jsx)("tbody",{children:["brainstorm","in-progress","done","archived"].map(e=>(0,a.jsx)(n.Fragment,{children:t.map(t=>{if("archived"===t.statusId)return null;if(t.statusId===e){var n,r;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:t.content}),(0,a.jsx)("td",{children:(0,a.jsxs)("select",{className:"select select-bordered select-sm w-full max-w-xs",value:null!=(r=t.labelId)?r:"",onChange:e=>{let s=e.target.value;l(t.id,t.content,""===s?null:s)},children:[(0,a.jsx)("option",{value:"",children:"未分類"}),s.map(e=>(0,a.jsx)("option",{value:e.id,className:"".concat(e.text),children:e.name},e.id))]})}),(0,a.jsx)("td",{children:null==(n=b.find(e=>e.id===t.statusId))?void 0:n.title}),(0,a.jsx)("td",{children:new Date(t.createdAt).toLocaleString()})]},t.id)}})},e))})]})})},f="kanban.tasks.v1",j="kanban.labels.v1",v=/[@＠]([A-Za-z0-9_-]+)/g;function N(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return console.warn("Parse localStorage failed:",e),null}}let y=e=>{let{labelId:t}=e,s=g.find(e=>e.id===t);return(0,a.jsx)("div",{"aria-label":"status",className:"status ".concat(null==s?void 0:s.status)})},S=e=>{let{id:t,content:s,statusId:l,labelId:i,onDelete:m,onEdit:x,onArchive:b}=e,{attributes:h,listeners:g,setNodeRef:p,transform:f,transition:j,isDragging:N}=(0,r.gl)({id:t}),[S,I]=(0,n.useState)(!1),[w,k]=(0,n.useState)(s),A={transform:d.Ks.Transform.toString(f),transition:j},D=()=>{w.trim()&&(x(t,w.trim()),k(w.replace(v," ").replace(/\s+/g," ").trim()),I(!1))};return(0,a.jsx)("li",{ref:p,style:A,className:"rounded-md border ".concat(N?"border-2 border-dashed border-base-300 bg-base-200 text-neutral-content opacity-30":"bg-base-200 border-base-300 hover:bg-base-100"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-base-content",children:[S?(0,a.jsx)("input",{className:"input input-sm w-full flex-1 p-3 pe-0 my-2 ms-1 border-0 focus:outline-none",value:w,onChange:e=>k(e.target.value),onKeyDown:e=>"Enter"===e.key&&D(),autoFocus:!0}):(0,a.jsxs)("div",{...h,...g,className:"flex items-center gap-2 flex-1 p-3 pe-0 select-none cursor-grab touch-none text-xs",children:[(0,a.jsx)(y,{labelId:i}),(0,a.jsx)("span",{children:s})]}),(0,a.jsxs)("div",{className:"flex items-center gap-[0.5px] me-1",children:[S?(0,a.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",title:"儲存",onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),D()},children:(0,a.jsx)(c.CMH,{className:"text-success text-lg"})}):(0,a.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),I(!0)},title:"編輯",children:(0,a.jsx)(c.uO9,{className:"text-base-content text-lg opacity-50"})}),"done"===l?(0,a.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),b(t)},title:"封存",children:(0,a.jsx)(u.sHL,{className:"text-info text-lg scale-95 opacity-65"})}):(0,a.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),m(t)},title:"刪除",children:(0,a.jsx)(o.uDv,{className:"text-error text-lg opacity-50"})})]})]})})},I=e=>{let{id:t,title:s,tasks:i,labels:d,onAddTask:c,onDeleteTask:o,onEditTask:u,onArchiveTask:m}=e,{setNodeRef:x}=(0,l.zM)({id:t}),[b,h]=(0,n.useState)("");return(0,a.jsxs)("div",{ref:x,className:"flex h-full min-h-40 flex-col rounded-md border p-3 bg-base-100 border-base-300 text-base-content",children:[(0,a.jsx)("h3",{className:"mb-2 text-base-content font-semibold opacity-85",children:s}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(r.gB,{items:i.map(e=>e.id),strategy:r._G,children:(0,a.jsx)("ul",{className:"flex flex-col gap-2",children:i.map(e=>(0,a.jsx)(S,{id:e.id,content:e.content,statusId:e.statusId,labelId:e.labelId,onDelete:o,onEdit:u,onArchive:m},e.id))})}),0===i.length&&(0,a.jsx)("div",{className:"flex h-20 items-center justify-center rounded-md border border-dashed bg-base-100 text-base-content border-base-300",children:(0,a.jsx)("p",{className:"text-sm",children:"目前沒有任務"})})]}),(0,a.jsx)("div",{className:"mt-3 flex gap-2 hover:bg-base-200 rounded-md",children:(0,a.jsx)("input",{type:"text",placeholder:"新增任務...",className:"input input-ghost input-xs border-0 rounded-md focus:outline-none",value:b,onChange:e=>h(e.target.value),onKeyDown:e=>"Enter"===e.key&&void(b.trim()&&(c(t,b.trim()),h("")))})})]})},w=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:"cursor-grabbing rounded-md bg-base-100 text-base-content text-xs p-3 shadow-md",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:"⋮"}),(0,a.jsx)("span",{children:t})]})})};function k(){var e;let[t,s]=(0,n.useState)(b),[d,o]=(0,n.useState)(h),[S,k]=(0,n.useState)(g),[A,D]=(0,n.useState)(null),C=(0,n.useRef)(!1);(0,n.useEffect)(()=>{if(C.current)return;C.current=!0;let e=N(localStorage.getItem(f));(null==e?void 0:e.version)===1&&Array.isArray(e.items)?o(e.items):o(h);let t=N(localStorage.getItem(j));(null==t?void 0:t.version)===1&&Array.isArray(t.items)?k(t.items):k(g)},[]),(0,n.useEffect)(()=>{G(d)},[d]),(0,n.useEffect)(()=>{V(S)},[S]);let O=(0,l.FR)((0,l.MS)(l.AN,{activationConstraint:{delay:50,tolerance:5}}),(0,l.MS)(l.uN,{coordinateGetter:r.JR})),T=e=>{var t;return null==(t=d.find(t=>t.id===e))?void 0:t.statusId},E=(e,t)=>{let s,a;for(v.lastIndex=0;null!==(a=v.exec(e));){let e=a[1];if(t.some(t=>t.id===e)){s=e;break}}return{cleaned:e.replace(v," ").replace(/\s+/g," ").trim()||e.trim(),labelId:s}},M=(e,t)=>{let{cleaned:s,labelId:a}=E(t,S),n={id:crypto.randomUUID(),statusId:e,content:s,labelId:a,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(e=>[...e,n])},P=e=>{o(t=>t.filter(t=>t.id!==e))},Z=(e,t,s)=>{let{cleaned:a,labelId:n}=E(t,S);o(t=>t.map(t=>{var l;if(t.id!==e)return t;let r=null===s?void 0:null!=(l=null!=s?s:n)?l:t.labelId;return t.content===a&&t.labelId===r?t:{...t,content:a,labelId:r,updatedAt:new Date().toISOString()}}))},J=e=>{o(t=>t.map(t=>t.id===e?{...t,statusId:"archived",updatedAt:new Date().toISOString()}:t))},[R,L]=(0,n.useState)(null),[_,F]=(0,n.useState)(""),B=e=>{k(t=>{let s=[...t];return s[e]={...s[e],name:_.trim()||s[e].id},s}),L(null),F("")},U=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=d.filter(e=>"in-progress"===e.statusId).map(e=>{var t,s,a;return"".concat((t=e.labelId,null!=(a=null==(s=S.find(e=>e.id===t))?void 0:s.name)?a:"其他"),"－").concat(e.content)}).join("\n");navigator.clipboard.writeText(e).then(()=>{console.log("✅ 日報已複製到剪貼簿")}).catch(e=>{console.error("❌ 複製失敗",e)})},H=d.filter(e=>"archived"===e.statusId),z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"todo";o(s=>s.map(s=>s.id===e?{...s,statusId:t,updatedAt:new Date().toISOString()}:s))};function K(e,t){let s;return function(){for(var a=arguments.length,n=Array(a),l=0;l<a;l++)n[l]=arguments[l];clearTimeout(s),s=setTimeout(()=>{e(...n)},t)}}let G=K(e=>{try{let t={version:1,updatedAt:new Date().toISOString(),items:e};localStorage.setItem(f,JSON.stringify(t))}catch(e){console.error("Save tasks failed:",e)}},400),V=K(e=>{try{let t={version:1,updatedAt:new Date().toISOString(),items:e};localStorage.setItem(j,JSON.stringify(t))}catch(e){console.error("Save labels failed:",e)}},400),$=(0,n.useRef)(null);return(0,a.jsxs)("div",{className:"mx-auto w-full",children:[(0,a.jsxs)("div",{className:"mb-5 flex flex-column justify-between items-center",children:[(0,a.jsx)("a",{className:"text-xl font-bold text-primary",children:"康邦 • 博德！"}),(0,a.jsxs)("div",{className:"flex justify-end gap-1",children:[(0,a.jsxs)("button",{className:"btn btn-soft btn-error rounded gap-2",onClick:()=>{confirm("確定要重置所有資料嗎？這個動作無法復原！")?(localStorage.removeItem(f),localStorage.removeItem(j),o(h),k(g),i.o.success("已重置任務與標籤")):i.o.error("已取消")},children:[(0,a.jsx)(x.zOm,{className:"scale-130"}),"重置"]}),(0,a.jsxs)("button",{className:"btn btn-soft btn-secondary rounded gap-2",onClick:()=>{let e=new Blob([JSON.stringify({version:1,exportedAt:new Date().toISOString(),tasks:{version:1,updatedAt:new Date().toISOString(),items:d},labels:{version:1,updatedAt:new Date().toISOString(),items:S}},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="kanban-export-".concat(new Date().toISOString().slice(0,10),".json"),document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(t),i.o.success("匯出成功")},children:[(0,a.jsx)(u.Mbn,{className:"scale-110"})," 匯出"]}),(0,a.jsxs)("button",{className:"btn btn-soft btn-primary rounded gap-2",onClick:()=>{var e;return null==(e=$.current)?void 0:e.click()},children:[(0,a.jsx)(u.PiR,{})," 載入"]}),(0,a.jsx)("input",{ref:$,type:"file",accept:"application/json",className:"hidden",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(!s)return void i.o.error("請選擇一個 JSON 檔案！");if(!window.confirm("匯入將覆蓋目前的任務與標籤，是否繼續？")){e.target.value="",i.o.error("已取消匯入");return}let a=new FileReader;a.onload=()=>{try{var t,s,n,l;let e=JSON.parse(String(a.result));if(!(e&&1===e.version&&(null==(t=e.tasks)?void 0:t.version)===1&&Array.isArray(null==(s=e.tasks)?void 0:s.items)&&(null==(n=e.labels)?void 0:n.version)===1&&Array.isArray(null==(l=e.labels)?void 0:l.items)))return void i.o.error("檔案格式或版本不支援（需要 version: 1）");o(e.tasks.items),k(e.labels.items),localStorage.setItem(f,JSON.stringify(e.tasks)),localStorage.setItem(j,JSON.stringify(e.labels)),i.o.success("匯入成功")}catch(e){console.error("匯入失敗：",e),i.o.error("匯入失敗：無法解析 JSON")}finally{e.target.value=""}},a.readAsText(s)}}),(0,a.jsxs)("button",{className:"btn btn-soft btn-success rounded gap-2",onClick:()=>{U(),i.o.success("日報已複製到剪貼簿！")},children:[(0,a.jsx)(m.vky,{className:"scale-140"}),"生成"]}),(0,a.jsxs)("button",{className:"btn btn-soft btn-info rounded gap-2",onClick:()=>{let e=document.getElementById("archiveModal");e&&e.showModal()},children:[(0,a.jsx)(u.sHL,{}),"封存區",(0,a.jsx)("span",{className:"badge",children:H.length})]}),(0,a.jsxs)("dialog",{id:"archiveModal",className:"modal",children:[(0,a.jsxs)("div",{className:"modal-box max-w-3xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg",children:["封存區（",H.length,"）"]}),(0,a.jsx)("form",{method:"dialog",children:(0,a.jsx)("button",{className:"btn btn-ghost btn-sm",children:"✕"})})]}),0===H.length?(0,a.jsx)("div",{className:"mt-4 alert",children:"目前沒有封存的任務。"}):(0,a.jsxs)("div",{className:"mt-4 overflow-x-auto rounded bg-base-100",children:[(0,a.jsxs)("table",{className:"table table-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"計畫"}),(0,a.jsx)("th",{children:"內容"}),(0,a.jsx)("th",{children:"建立時間"}),(0,a.jsx)("th",{children:"還原到"}),(0,a.jsx)("th",{className:"text-right",children:"操作"})]})}),(0,a.jsx)("tbody",{children:H.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"w-24",children:(0,a.jsx)(y,{labelId:e.labelId})}),(0,a.jsx)("td",{className:"max-w-[320px]",children:(0,a.jsx)("div",{className:"truncate",children:e.content})}),(0,a.jsx)("td",{className:"whitespace-nowrap",children:new Date(e.createdAt).toLocaleString()}),(0,a.jsx)("td",{className:"w-40",children:(0,a.jsx)("select",{className:"select select-bordered select-xs w-full",defaultValue:"todo",id:"restore-select-".concat(e.id),children:t.filter(e=>"archived"!==e.id).map(e=>(0,a.jsx)("option",{value:e.id,children:e.title},e.id))})}),(0,a.jsx)("td",{className:"text-right",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{className:"btn btn-xs btn-soft btn-success rounded",onClick:()=>{let t=document.getElementById("restore-select-".concat(e.id)),s=(null==t?void 0:t.value)||"todo";z(e.id,s)},children:"還原"}),(0,a.jsx)("button",{className:"btn btn-xs btn-soft btn-error rounded",onClick:()=>{var t;return t=e.id,void o(e=>e.filter(e=>e.id!==t))},children:"刪除"})]})})]},e.id))})]}),(0,a.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,a.jsx)("div",{className:"text-xs opacity-70",children:"提示：還原預設回「腦力激盪」，可在下拉選單選擇其他狀態。"}),(0,a.jsx)("button",{className:"btn btn-sm btn-error btn-outline rounded",onClick:()=>{o(e=>e.filter(e=>"archived"!==e.statusId))},children:"清空封存"})]})]})]}),(0,a.jsx)("form",{method:"dialog",className:"modal-backdrop",children:(0,a.jsx)("button",{children:"close"})})]})]})]}),(0,a.jsxs)(l.Mp,{sensors:O,collisionDetection:l.y$,onDragStart:e=>{D(e.active.id)},onDragCancel:()=>{D(null)},onDragOver:e=>{var t,s;let{active:a,over:n}=e;if(!n)return;let l=a.id,r=n.id,i=null!=(t=T(l))?t:l,d=null!=(s=T(r))?s:r;i!==d&&o(e=>e.map(e=>e.id===l?{...e,statusId:d}:e))},onDragEnd:e=>{var t,s;let{active:a,over:n}=e;if(!n)return void D(null);let l=a.id,i=n.id,c=null!=(t=T(l))?t:l;if(c===(null!=(s=T(i))?s:i)){let e=d.filter(e=>e.statusId===c),t=e.findIndex(e=>e.id===l),s=e.findIndex(e=>e.id===i);if(-1!==t&&-1!==s){let a=(0,r.be)(e,t,s);o(e=>[...e.filter(e=>e.statusId!==c),...a])}}D(null)},children:[(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:t.map(e=>{let t;return"archived"===e.id?null:(0,a.jsx)(I,{id:e.id,title:e.title,tasks:(t=e.id,d.filter(e=>e.statusId===t)),labels:S,onAddTask:M,onDeleteTask:P,onEditTask:Z,onArchiveTask:J},e.id)})}),(0,a.jsx)(l.Hd,{dropAnimation:{duration:150,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},children:A?(0,a.jsx)(w,{children:null==(e=d.find(e=>e.id===A)||null)?void 0:e.content}):null})]}),(0,a.jsx)("div",{className:"divider"}),(0,a.jsx)("div",{className:"my-3 mb-2",children:(0,a.jsx)("ul",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-2",children:S.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-center gap-2 bg-base-100 rounded p-3",children:[(0,a.jsx)("span",{className:"badge badge-xs ".concat(e.badge," w-4 justify-center")}),R===t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{className:"input input-xs input-bordered pe-0 border-0 ",value:_,onChange:e=>F(e.target.value),onKeyDown:e=>"Enter"===e.key&&B(t),autoFocus:!0}),(0,a.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",title:"儲存",onClick:()=>B(t),children:(0,a.jsx)(c.CMH,{className:"text-success"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"flex-1 truncate text-xs",children:e.name}),(0,a.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",title:"編輯",onClick:()=>{L(t),F(e.name)},children:(0,a.jsx)(c.uO9,{className:"text-base-content opacity-50"})})]})]},e.id))})}),(0,a.jsx)("div",{className:"overflow-auto max-h-80",children:(0,a.jsx)(p,{tasks:d,labels:S,onEditTask:Z})})]})}function A(){return(0,a.jsx)("div",{className:"mx-auto max-w-4xl p-4 pt-14 min-h-screen flex justify-center items-start",children:(0,a.jsx)("div",{className:"rounded-lg p-6 bg-base-200 min-w-216",children:(0,a.jsx)(k,{})})})}},7132:(e,t,s)=>{Promise.resolve().then(s.bind(s,5921))}},e=>{e.O(0,[479,711,446,87,873,671,75,441,964,358],()=>e(e.s=7132)),_N_E=e.O()}]);