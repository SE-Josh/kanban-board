(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5921:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>k});var n=s(5155),a=s(2115),l=s(5143),r=s(402),i=s(6671),d=s(8266),c=s(9911),o=s(2515),u=s(4315),m=s(5305),x=s(7859);let b=[{id:"brainstorm",title:"腦力激盪"},{id:"in-progress",title:"如火如荼"},{id:"done",title:"修成正果"},{id:"archived",title:"蛋雕區"}],h=[{id:"565a2883-8b76-4bfd-a5bf-282fb5df5fd7",statusId:"brainstorm",content:"關閉訂單與結帳",createdAt:"2025-08-12T02:35:24.226Z",updatedAt:"2025-08-12T02:35:24.226Z"},{id:"fe4734cc-d9da-4be8-969f-9777e81484ee",statusId:"brainstorm",content:"取得外送餐點",createdAt:"2025-08-12T02:35:48.800Z",updatedAt:"2025-08-12T02:35:48.800Z"},{id:"9c3cf7c0-434a-44dc-9979-9ad22ba45af0",statusId:"done",content:"選擇飲料店",createdAt:"2025-08-12T02:34:39.836Z",updatedAt:"2025-08-12T02:34:39.836Z"},{id:"617e8b0a-e3d5-48df-b050-1e614bb50e4a",statusId:"in-progress",content:"分享團購訂單",createdAt:"2025-08-12T02:34:47.340Z",updatedAt:"2025-08-12T02:34:47.340Z"},{id:"a58e6891-1ce0-4a70-99a1-d5aa7e1bcd70",statusId:"in-progress",content:"將品項加入購物車",createdAt:"2025-08-12T02:35:02.867Z",updatedAt:"2025-08-12T02:35:02.867Z"}],g=[{id:"A",name:"A 計畫",badge:"badge-primary",status:"status-primary",text:"text-primary"},{id:"B",name:"B 計畫",badge:"badge-secondary",status:"status-secondary",text:"text-secondary"},{id:"C",name:"C 計畫",badge:"badge-accent",status:"status-accent",text:"text-accent"},{id:"D",name:"D 計畫",badge:"badge-info",status:"status-info",text:"text-info"},{id:"E",name:"E 計畫",badge:"badge-success",status:"status-success",text:"text-success"}],f=e=>{let{tasks:t,labels:s,onEditTask:l}=e;return(0,n.jsx)("div",{className:"overflow-x-auto mt-5 rounded bg-base-100",children:(0,n.jsxs)("table",{className:"table table-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"內容"}),(0,n.jsx)("th",{children:"計畫"}),(0,n.jsx)("th",{children:"狀態"}),(0,n.jsx)("th",{children:"建立時間"})]})}),(0,n.jsx)("tbody",{children:["brainstorm","in-progress","done","archived"].map(e=>(0,n.jsx)(a.Fragment,{children:t.map(t=>{if("archived"===t.statusId)return null;if(t.statusId===e){var a,r;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:t.content}),(0,n.jsx)("td",{children:(0,n.jsxs)("select",{className:"select select-bordered select-sm w-full max-w-xs",value:null!=(r=t.labelId)?r:"",onChange:e=>{let s=e.target.value;l(t.id,t.content,""===s?null:s)},children:[(0,n.jsx)("option",{value:"",children:"未分類"}),s.map(e=>(0,n.jsx)("option",{value:e.id,className:"".concat(e.text),children:e.name},e.id))]})}),(0,n.jsx)("td",{children:null==(a=b.find(e=>e.id===t.statusId))?void 0:a.title}),(0,n.jsx)("td",{children:new Date(t.createdAt).toLocaleString()})]},t.id)}})},e))})]})})},p="kanban.tasks.v1",j="kanban.labels.v1",v=/[@＠]([A-Za-z0-9_-]+)/g;function N(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return console.warn("Parse localStorage failed:",e),null}}let y=e=>{let{labelId:t}=e,s=g.find(e=>e.id===t);return(0,n.jsx)("div",{"aria-label":"status",className:"status ".concat(null==s?void 0:s.status)})},S=e=>{let{id:t,content:s,statusId:l,labelId:i,onDelete:m,onEdit:x,onArchive:b}=e,{attributes:h,listeners:g,setNodeRef:f,transform:p,transition:j,isDragging:N}=(0,r.gl)({id:t}),[S,I]=(0,a.useState)(!1),[w,A]=(0,a.useState)(s),k={transform:d.Ks.Transform.toString(p),transition:j},D=()=>{w.trim()&&(x(t,w.trim()),A(w.replace(v," ").replace(/\s+/g," ").trim()),I(!1))};return(0,n.jsx)("li",{ref:f,style:k,className:"rounded-md border ".concat(N?"border-2 border-dashed border-base-300 bg-base-200 text-neutral-content opacity-30":"bg-base-200 border-base-300 hover:bg-base-100"),children:(0,n.jsxs)("div",{className:"flex items-center justify-between text-base-content",children:[S?(0,n.jsx)("input",{className:"input input-sm w-full flex-1 p-3 pe-0 my-2 ms-1 border-0 focus:outline-none",value:w,onChange:e=>A(e.target.value),onKeyDown:e=>"Enter"===e.key&&D(),autoFocus:!0}):(0,n.jsxs)("div",{...h,...g,className:"flex items-center gap-2 flex-1 p-3 pe-0 select-none cursor-grab touch-none text-xs",children:[(0,n.jsx)(y,{labelId:i}),(0,n.jsx)("span",{children:s})]}),(0,n.jsxs)("div",{className:"flex items-center gap-[0.5px] me-1",children:[S?(0,n.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",title:"儲存",onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),D()},children:(0,n.jsx)(c.CMH,{className:"text-success text-lg"})}):(0,n.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),I(!0)},title:"編輯",children:(0,n.jsx)(c.uO9,{className:"text-base-content text-lg opacity-50"})}),"done"===l?(0,n.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),b(t)},title:"封存",children:(0,n.jsx)(u.sHL,{className:"text-info text-lg scale-95 opacity-65"})}):(0,n.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),m(t)},title:"刪除",children:(0,n.jsx)(o.uDv,{className:"text-error text-lg opacity-50"})})]})]})})},I=e=>{let{id:t,title:s,tasks:i,labels:d,onAddTask:c,onDeleteTask:o,onEditTask:u,onArchiveTask:m}=e,{setNodeRef:x}=(0,l.zM)({id:t}),[b,h]=(0,a.useState)("");return(0,n.jsxs)("div",{ref:x,className:"flex h-full min-h-40 flex-col rounded-md border p-3 bg-base-100 border-base-300 text-base-content",children:[(0,n.jsx)("h3",{className:"mb-2 text-base-content font-semibold opacity-85",children:s}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)(r.gB,{items:i.map(e=>e.id),strategy:r._G,children:(0,n.jsx)("ul",{className:"flex flex-col gap-2",children:i.map(e=>(0,n.jsx)(S,{id:e.id,content:e.content,statusId:e.statusId,labelId:e.labelId,onDelete:o,onEdit:u,onArchive:m},e.id))})}),0===i.length&&(0,n.jsx)("div",{className:"flex h-20 items-center justify-center rounded-md border border-dashed bg-base-100 text-base-content border-base-300",children:(0,n.jsx)("p",{className:"text-sm",children:"目前沒有任務"})})]}),(0,n.jsx)("div",{className:"mt-3 flex gap-2 hover:bg-base-200 rounded-md",children:(0,n.jsx)("input",{type:"text",placeholder:"新增任務...",className:"input input-ghost input-xs border-0 rounded-md focus:outline-none",value:b,onChange:e=>h(e.target.value),onKeyDown:e=>"Enter"===e.key&&void(b.trim()&&(c(t,b.trim()),h("")))})})]})},w=e=>{let{children:t}=e;return(0,n.jsx)("div",{className:"cursor-grabbing rounded-md bg-base-100 text-base-content text-xs p-3 shadow-md",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{children:"⋮"}),(0,n.jsx)("span",{children:t})]})})};function A(){var e;let[t,s]=(0,a.useState)(b),[d,o]=(0,a.useState)(h),[S,A]=(0,a.useState)(g),[k,D]=(0,a.useState)(null),O=(0,a.useRef)(!1),C=(0,a.useRef)(null),T=(0,a.useRef)(null);function E(e,t){let s;return function(){for(var n=arguments.length,a=Array(n),l=0;l<n;l++)a[l]=arguments[l];clearTimeout(s),s=setTimeout(()=>{e(...a)},t)}}(0,a.useEffect)(()=>()=>{T.current&&cancelAnimationFrame(T.current)},[]),(0,a.useEffect)(()=>{if(O.current)return;O.current=!0;let e=N(localStorage.getItem(p));(null==e?void 0:e.version)===1&&Array.isArray(e.items)?o(e.items):o(h);let t=N(localStorage.getItem(j));(null==t?void 0:t.version)===1&&Array.isArray(t.items)?A(t.items):A(g)},[]);let M=(0,a.useMemo)(()=>E(e=>{try{let t={version:1,updatedAt:new Date().toISOString(),items:e};localStorage.setItem(p,JSON.stringify(t))}catch(e){console.error("Save tasks failed:",e)}},400),[]),R=(0,a.useMemo)(()=>E(e=>{try{let t={version:1,updatedAt:new Date().toISOString(),items:e};localStorage.setItem(j,JSON.stringify(t))}catch(e){console.error("Save labels failed:",e)}},400),[]);(0,a.useEffect)(()=>{M(d)},[d,M]),(0,a.useEffect)(()=>{R(S)},[S,R]);let F=(0,l.FR)((0,l.MS)(l.AN,{activationConstraint:{delay:50,tolerance:5}}),(0,l.MS)(l.uN,{coordinateGetter:r.JR})),P=e=>{var t;return null==(t=d.find(t=>t.id===e))?void 0:t.statusId},Z=(e,t)=>{let s,n;for(v.lastIndex=0;null!==(n=v.exec(e));){let e=n[1];if(t.some(t=>t.id===e)){s=e;break}}return{cleaned:e.replace(v," ").replace(/\s+/g," ").trim()||e.trim(),labelId:s}},J=(e,t)=>{let{cleaned:s,labelId:n}=Z(t,S),a={id:crypto.randomUUID(),statusId:e,content:s,labelId:n,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o(e=>[...e,a])},L=e=>{o(t=>t.filter(t=>t.id!==e))},_=(e,t,s)=>{let{cleaned:n,labelId:a}=Z(t,S);o(t=>t.map(t=>{var l;if(t.id!==e)return t;let r=null===s?void 0:null!=(l=null!=s?s:a)?l:t.labelId;return t.content===n&&t.labelId===r?t:{...t,content:n,labelId:r,updatedAt:new Date().toISOString()}}))},B=e=>{o(t=>t.map(t=>t.id===e?{...t,statusId:"archived",updatedAt:new Date().toISOString()}:t))},[U,H]=(0,a.useState)(null),[z,K]=(0,a.useState)(""),G=e=>{A(t=>{let s=[...t];return s[e]={...s[e],name:z.trim()||s[e].id},s}),H(null),K("")},q=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=d.filter(e=>"in-progress"===e.statusId).map(e=>{var t,s,n;return"".concat((t=e.labelId,null!=(n=null==(s=S.find(e=>e.id===t))?void 0:s.name)?n:"其他"),"－").concat(e.content)}).join("\n");navigator.clipboard.writeText(e).then(()=>{console.log("✅ 日報已複製到剪貼簿")}).catch(e=>{console.error("❌ 複製失敗",e)})},V=d.filter(e=>"archived"===e.statusId),$=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"todo";o(s=>s.map(s=>s.id===e?{...s,statusId:t,updatedAt:new Date().toISOString()}:s))},Q=(0,a.useRef)(null);return(0,n.jsxs)("div",{className:"mx-auto w-full",children:[(0,n.jsxs)("div",{className:"mb-5 flex flex-column justify-between items-center",children:[(0,n.jsx)("a",{className:"text-xl font-bold text-primary",children:"康邦 • 博德！"}),(0,n.jsxs)("div",{className:"flex justify-end gap-1",children:[(0,n.jsxs)("button",{className:"btn btn-soft btn-error rounded gap-2",onClick:()=>{confirm("確定要重置所有資料嗎？這個動作無法復原！")?(localStorage.removeItem(p),localStorage.removeItem(j),o(h),A(g),i.o.success("已重置任務與標籤")):i.o.error("已取消")},children:[(0,n.jsx)(x.zOm,{className:"scale-130"}),"重置"]}),(0,n.jsxs)("button",{className:"btn btn-soft btn-secondary rounded gap-2",onClick:()=>{let e=new Blob([JSON.stringify({version:1,exportedAt:new Date().toISOString(),tasks:{version:1,updatedAt:new Date().toISOString(),items:d},labels:{version:1,updatedAt:new Date().toISOString(),items:S}},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="kanban-export-".concat(new Date().toISOString().slice(0,10),".json"),document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(t),i.o.success("匯出成功")},children:[(0,n.jsx)(u.Mbn,{className:"scale-110"})," 匯出"]}),(0,n.jsxs)("button",{className:"btn btn-soft btn-primary rounded gap-2",onClick:()=>{var e;return null==(e=Q.current)?void 0:e.click()},children:[(0,n.jsx)(u.PiR,{})," 載入"]}),(0,n.jsx)("input",{ref:Q,type:"file",accept:"application/json",className:"hidden",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(!s)return void i.o.error("請選擇一個 JSON 檔案！");if(!window.confirm("匯入將覆蓋目前的任務與標籤，是否繼續？")){e.target.value="",i.o.error("已取消匯入");return}let n=new FileReader;n.onload=()=>{try{var t,s,a,l;let e=JSON.parse(String(n.result));if(!(e&&1===e.version&&(null==(t=e.tasks)?void 0:t.version)===1&&Array.isArray(null==(s=e.tasks)?void 0:s.items)&&(null==(a=e.labels)?void 0:a.version)===1&&Array.isArray(null==(l=e.labels)?void 0:l.items)))return void i.o.error("檔案格式或版本不支援（需要 version: 1）");o(e.tasks.items),A(e.labels.items),localStorage.setItem(p,JSON.stringify(e.tasks)),localStorage.setItem(j,JSON.stringify(e.labels)),i.o.success("匯入成功")}catch(e){console.error("匯入失敗：",e),i.o.error("匯入失敗：無法解析 JSON")}finally{e.target.value=""}},n.readAsText(s)}}),(0,n.jsxs)("button",{className:"btn btn-soft btn-success rounded gap-2",onClick:()=>{q(),i.o.success("日報已複製到剪貼簿！")},children:[(0,n.jsx)(m.vky,{className:"scale-140"}),"生成"]}),(0,n.jsxs)("button",{className:"btn btn-soft btn-info rounded gap-2",onClick:()=>{let e=document.getElementById("archiveModal");e&&e.showModal()},children:[(0,n.jsx)(u.sHL,{}),"封存區",(0,n.jsx)("span",{className:"badge",children:V.length})]}),(0,n.jsxs)("dialog",{id:"archiveModal",className:"modal",children:[(0,n.jsxs)("div",{className:"modal-box max-w-3xl",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("h3",{className:"font-bold text-lg",children:["封存區（",V.length,"）"]}),(0,n.jsx)("form",{method:"dialog",children:(0,n.jsx)("button",{className:"btn btn-ghost btn-sm",children:"✕"})})]}),0===V.length?(0,n.jsx)("div",{className:"mt-4 alert",children:"目前沒有封存的任務。"}):(0,n.jsxs)("div",{className:"mt-4 overflow-x-auto rounded bg-base-100",children:[(0,n.jsxs)("table",{className:"table table-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"計畫"}),(0,n.jsx)("th",{children:"內容"}),(0,n.jsx)("th",{children:"建立時間"}),(0,n.jsx)("th",{children:"還原到"}),(0,n.jsx)("th",{className:"text-right",children:"操作"})]})}),(0,n.jsx)("tbody",{children:V.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"w-24",children:(0,n.jsx)(y,{labelId:e.labelId})}),(0,n.jsx)("td",{className:"max-w-[320px]",children:(0,n.jsx)("div",{className:"truncate",children:e.content})}),(0,n.jsx)("td",{className:"whitespace-nowrap",children:new Date(e.createdAt).toLocaleString()}),(0,n.jsx)("td",{className:"w-40",children:(0,n.jsx)("select",{className:"select select-bordered select-xs w-full",defaultValue:"todo",id:"restore-select-".concat(e.id),children:t.filter(e=>"archived"!==e.id).map(e=>(0,n.jsx)("option",{value:e.id,children:e.title},e.id))})}),(0,n.jsx)("td",{className:"text-right",children:(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)("button",{className:"btn btn-xs btn-soft btn-success rounded",onClick:()=>{let t=document.getElementById("restore-select-".concat(e.id)),s=(null==t?void 0:t.value)||"todo";$(e.id,s)},children:"還原"}),(0,n.jsx)("button",{className:"btn btn-xs btn-soft btn-error rounded",onClick:()=>{var t;return t=e.id,void o(e=>e.filter(e=>e.id!==t))},children:"刪除"})]})})]},e.id))})]}),(0,n.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,n.jsx)("div",{className:"text-xs opacity-70",children:"提示：還原預設回「腦力激盪」，可在下拉選單選擇其他狀態。"}),(0,n.jsx)("button",{className:"btn btn-sm btn-error btn-outline rounded",onClick:()=>{o(e=>e.filter(e=>"archived"!==e.statusId))},children:"清空封存"})]})]})]}),(0,n.jsx)("form",{method:"dialog",className:"modal-backdrop",children:(0,n.jsx)("button",{children:"close"})})]})]})]}),(0,n.jsxs)(l.Mp,{sensors:F,collisionDetection:l.y$,onDragStart:e=>{D(e.active.id),C.current=null},onDragCancel:()=>{D(null),C.current=null},onDragOver:e=>{var t,s;let{active:n,over:a}=e;if(!a)return;let l=String(n.id),r=String(a.id),i=null!=(t=P(l))?t:l,d=null!=(s=P(r))?s:r;if(i===d)return;let c=C.current;c&&c.id===l&&c.status===d||(T.current&&cancelAnimationFrame(T.current),T.current=requestAnimationFrame(()=>{o(e=>e.map(e=>e.id===l?{...e,statusId:d,updatedAt:new Date().toISOString()}:e)),C.current={id:l,status:d}}))},onDragEnd:e=>{var t,s;let{active:n,over:a}=e;if(!a){D(null),C.current=null;return}let l=String(n.id),i=String(a.id),c=null!=(t=P(l))?t:l,u=null!=(s=P(i))?s:i;if(c===u){let e=d.filter(e=>e.statusId===c),t=e.findIndex(e=>e.id===l),s=e.findIndex(e=>e.id===i);if(-1!==t&&-1!==s&&t!==s){let n=(0,r.be)(e,t,s);o(e=>[...e.filter(e=>e.statusId!==c),...n])}}else{let e=d.filter(e=>e.statusId===u),t=e.findIndex(e=>e.id===i),s=t>=0?t:e.length;o(e=>{let t=e.map(e=>e.id===l?{...e,statusId:u,updatedAt:new Date().toISOString()}:e),n=t.find(e=>e.id===l),a=t.filter(e=>e.statusId===u&&e.id!==l);return[...t.filter(e=>e.statusId!==u),...a.slice(0,s),n,...a.slice(s)]})}D(null),C.current=null,T.current&&(cancelAnimationFrame(T.current),T.current=null)},children:[(0,n.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:t.map(e=>{let t;return"archived"===e.id?null:(0,n.jsx)(I,{id:e.id,title:e.title,tasks:(t=e.id,d.filter(e=>e.statusId===t)),labels:S,onAddTask:J,onDeleteTask:L,onEditTask:_,onArchiveTask:B},e.id)})}),(0,n.jsx)(l.Hd,{dropAnimation:{duration:150,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},children:k?(0,n.jsx)(w,{children:null==(e=d.find(e=>e.id===k)||null)?void 0:e.content}):null})]}),(0,n.jsx)("div",{className:"divider"}),(0,n.jsx)("div",{className:"my-3 mb-2",children:(0,n.jsx)("ul",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-2",children:S.map((e,t)=>(0,n.jsxs)("li",{className:"flex items-center gap-2 bg-base-100 rounded p-3",children:[(0,n.jsx)("span",{className:"badge badge-xs ".concat(e.badge," w-4 justify-center")}),U===t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("input",{className:"input input-xs input-bordered pe-0 border-0 ",value:z,onChange:e=>K(e.target.value),onKeyDown:e=>"Enter"===e.key&&G(t),autoFocus:!0}),(0,n.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",title:"儲存",onClick:()=>G(t),children:(0,n.jsx)(c.CMH,{className:"text-success"})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"flex-1 truncate text-xs",children:e.name}),(0,n.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost",title:"編輯",onClick:()=>{H(t),K(e.name)},children:(0,n.jsx)(c.uO9,{className:"text-base-content opacity-50"})})]})]},e.id))})}),(0,n.jsx)("div",{className:"overflow-auto max-h-80",children:(0,n.jsx)(f,{tasks:d,labels:S,onEditTask:_})})]})}function k(){return(0,n.jsx)("div",{className:"mx-auto max-w-4xl p-4 pt-14 min-h-screen flex justify-center items-start",children:(0,n.jsx)("div",{className:"rounded-lg p-6 bg-base-200 min-w-216",children:(0,n.jsx)(A,{})})})}},7132:(e,t,s)=>{Promise.resolve().then(s.bind(s,5921))}},e=>{e.O(0,[479,711,446,87,873,671,75,441,964,358],()=>e(e.s=7132)),_N_E=e.O()}]);